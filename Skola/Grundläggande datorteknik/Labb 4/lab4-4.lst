QAflisp - FLISP Absolute crossassembler, Version 1.3
(c) GMV 1989-2023


File: lab4-4.lst
FC                      1. Inport	EQU	$FC
---- File: "lab4-4.sflisp"
FB                      2. Utport	EQU	$FB
05                      3. DelayC1	EQU	$5		;Dessa konstanter styr hur lång fördröjning Delay1s orsakar.
02                      4. DelayC2	EQU	$2		;Ändra dem eventuellt i labbet så att fördröjnigen blir rimligt lång.
                        5. 
FF                      6. 	ORG	$FF
FF 20                   7. 	FCB	$20
                        8. 
20                      9. 	ORG	$20
                       10. 
20                     11. Main:
20 34 24               12. 	JSR ReadAscii
22 21 FC               13. 	BRA	Main
                       14. 
                       15. 
24                     16. ReadAscii:
24 13                  17. 	PSHC
25                     18. ReadAscii_1:
25 F1 FC               19. 	LDA Inport		; A <- Inport
27 0C                  20. 	LSRA			; CC(C) <- A bit0
28 28 FB               21. 	BCS ReadAscii_1	; CC(C) = 1 ?
2A 0C                  22. 	LSRA			; CC(C) <- A bit0
2B 29 F8               23. 	BCC ReadAscii_1 ; CC(C) = 0 ?
2D 0C                  24. 	LSRA			; A <- A >> 1
2E 17                  25. 	PULC
2F 43                  26. 	RTS				; Retur(A)
                       27. 
                       28. 
30                     29. 	
30                     30. BlinkLight:
30 10                  31. 	PSHA
31                     32. 	;LDA #$FF
31                     33. 	;STA Utport  		; TODO: gör utan att A ändras
31 98 80               34. 	BITA #%10000000 	; Om bit7 i A = 1
33 22 06               35. 	BMI	BlinkLight_s4	; JA
35 21 00               36. 	BRA BlinkLight_s1	; NEJ
37                     37. BlinkLight_s1:
37 34 47               38. 	JSR Delay1s
39 33 45               39. 	JMP BlinkLight_end
3B                     40. BlinkLight_s4:
3B 34 47               41. 	JSR Delay1s
3D 34 47               42. 	JSR Delay1s
3F 34 47               43. 	JSR Delay1s
41 34 47               44. 	JSR Delay1s
43 33 45               45. 	JMP BlinkLight_end
45                     46. BlinkLight_end:
45 14                  47. 	PULA
46 43                  48. 	RTS
47                     49. 	
47                     50. 	
                       51. ; Orsakar en fördröjning på ungefär 1s i simulatorn (vid snabb exekveringshastighet)
                       52. ; Ändrar inga register
47                     53. Delay1s:
47 10                  54. 	PSHA
48 11                  55. 	PSHX
49 13                  56. 	PSHC
4A 90 02               57. 	LDX	#DelayC2
4C                     58. Delay1s_loop2:
4C F0 05               59. 	LDA	#DelayC1
4E                     60. Delay1s_loop:
4E 08                  61. 	DECA
4F 25 FD               62. 	BNE	Delay1s_loop
51 CC FF               63. 	LEAX	-1,X
53 9C 00               64. 	CMPX	#0
55 25 F5               65. 	BNE	Delay1s_loop2
57 17                  66. 	PULC
58 15                  67. 	PULX
59 14                  68. 	PULA
5A 43                  69. 	RTS
                       70. 
                       71. ; Data - Variabler
5B                     72. Count:
5B 00                  73. 	RMB	1
                       74. 
                       75. ; Data - Konstanter
5C                     76. MorseCode:
5C 02 40               77. 	FCB	2,%01000000 ;'A'
5E 04 80               78. 	FCB	4,%10000000 ;'B'
60 04 A0               79. 	FCB	4,%10100000 ;'C'
62 03 80               80. 	FCB	3,%10000000 ;'D'
64 01 00               81. 	FCB	1,%00000000 ;'E'
66 04 20               82. 	FCB	4,%00100000 ;'F'
68 03 C0               83. 	FCB	3,%11000000 ;'G'
6A 04 00               84. 	FCB	4,%00000000 ;'H'
6C 02 00               85. 	FCB	2,%00000000 ;'I'
6E 04 70               86. 	FCB	4,%01110000 ;'J'
70 03 A0               87. 	FCB	3,%10100000 ;'K'
72 04 40               88. 	FCB	4,%01000000 ;'L'
74 02 C0               89. 	FCB	2,%11000000 ;'M'
76 02 80               90. 	FCB	2,%10000000 ;'N'
78 03 E0               91. 	FCB	3,%11100000 ;'O'
7A 04 60               92. 	FCB	4,%01100000 ;'P'
7C 04 D0               93. 	FCB	4,%11010000 ;'Q'
7E 03 40               94. 	FCB	3,%01000000 ;'R'
80 03 00               95. 	FCB	3,%00000000 ;'S'
82 01 80               96. 	FCB	1,%10000000 ;'T'
84 03 20               97. 	FCB	3,%00100000 ;'U'
86 04 10               98. 	FCB	4,%00010000 ;'V'
88 03 60               99. 	FCB	3,%01100000 ;'W'
8A 04 90              100. 	FCB	4,%10010000 ;'X'
8C 04 B0              101. 	FCB	4,%10110000 ;'Y'
8E 04 C0              102. 	FCB	4,%11000000 ;'Z'
90                    103. 	
90                    104. 	
90                    105. 	
90                    106. 	
90                    107. 	
90                    108. 	
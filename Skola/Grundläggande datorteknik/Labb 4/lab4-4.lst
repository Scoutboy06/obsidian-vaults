QAflisp - FLISP Absolute crossassembler, Version 1.3
(c) GMV 1989-2023


File: lab4-4.lst
FC                      1. Inport	EQU	$FC
---- File: "lab4-4.sflisp"
FB                      2. Utport	EQU	$FB
05                      3. DelayC1	EQU	$5		;Dessa konstanter styr hur lång fördröjning Delay1s orsakar.
02                      4. DelayC2	EQU	$2		;Ändra dem eventuellt i labbet så att fördröjnigen blir rimligt lång.
                        5. 
FF                      6. 	ORG	$FF
FF 20                   7. 	FCB	$20
                        8. 
20                      9. 	ORG	$20
                       10. 
20                     11. Main:
20 35 FB               12. 	CLR Utport
22                     13. Main_1:
22 34 47               14. 	JSR ReadAscii
24 94 41               15. 	SUBA #$41		; Räkna ut ordningstalet för bokstaven som lästes in. (Ordningstalet för 'A' = 0)
26 29 0A               16. 	BCC Main_2		; input < 'A'?
28 97 19               17. 	CMPA #25		; input > 'Z'?
2A 2A 06               18. 	BHI Main_2		; NEJ
2C                     19. Main_err:
2C 35 FB               20. 	CLR Utport
2E 3A FB               21. 	COM Utport
30 33 22               22. 	JMP Main_1
32                     23. Main_2:
32 0B                  24. 	LSLA ; A <- 2A
33 10                  25. 	PSHA
34 90 89               26. 	LDX #MorseCode	; X <- Startadress för tabell med Morsekoder
36 F4                  27. 	LDA A,X  		; Hämta antalet pulser för bokstaven
37 E1 88               28. 	STA Count		; Count är en variabel (reserverad byte i minnet)
39 14                  29. 	PULA
3A 07                  30. 	INCA			; Beräkna offset för pulsmönstret
3B E4                  31. 	STA A,X  		; Hämta pulsmönstret (Morsekoden) för bokstaven
3C                     32. Main_3:
3C 34 57               33. 	JSR BlinkLight	; Anropa blinkrutinen
3E 0B                  34. 	LSLA			; A <- A << 1
3F 38 88               35. 	DEC Count		; Count <- Count - 1
41 39 88               36. 	TST Count		; Count=0 ?
43 25 F7               37. 	BNE Main_3		; NEJ
45 33 20               38. 	JMP	Main		; Börja om från inläsningen
                       39. 
                       40. 
47                     41. ReadAscii:
47 13                  42. 	PSHC
48                     43. ReadAscii_1:
48 F1 FC               44. 	LDA Inport		; A <- Inport
4A 98 01               45. 	BITA #%00000001	; CC(Z) = NOT A bit0
4C 25 FA               46. 	BNE ReadAscii_1	; CC(Z) = 1 ?
4E                     47. ReadAscii_2:
4E F1 FC               48. 	LDA Inport
50 98 01               49. 	BITA #%00000001	; CC(Z) <- A bit0
52 24 FA               50. 	BEQ ReadAscii_2 ; CC(Z) = 0 ?
54 0C                  51. 	LSRA			; A <- A >> 1
55 17                  52. 	PULC
56 43                  53. 	RTS				; Retur(A)
                       54. 
                       55. 
57                     56. 	
57                     57. BlinkLight:
57 10                  58. 	PSHA
58 35 FB               59. 	CLR Utport			; A <- 0
5A 3A FB               60. 	COM Utport			; A <- $FF
5C 98 80               61. 	BITA #%10000000 	; Om bit7 i A = 1
5E 22 04               62. 	BMI	BlinkLight_s4	; JA
60                     63. BlinkLight_s1:
60 34 74               64. 	JSR Delay1s
62 33 6E               65. 	JMP BlinkLight_end
64                     66. BlinkLight_s4:
64 34 74               67. 	JSR Delay1s
66 34 74               68. 	JSR Delay1s
68 34 74               69. 	JSR Delay1s
6A 34 74               70. 	JSR Delay1s
6C 33 6E               71. 	JMP BlinkLight_end
6E                     72. BlinkLight_end:
6E 35 FB               73. 	CLR Utport
70 34 74               74. 	JSR Delay1s
72 14                  75. 	PULA
73 43                  76. 	RTS
74                     77. 	
74                     78. 	
                       79. ; Orsakar en fördröjning på ungefär 1s i simulatorn (vid snabb exekveringshastighet)
                       80. ; Ändrar inga register
74                     81. Delay1s:
74 10                  82. 	PSHA
75 11                  83. 	PSHX
76 13                  84. 	PSHC
77 90 02               85. 	LDX	#DelayC2
79                     86. Delay1s_loop2:
79 F0 05               87. 	LDA	#DelayC1
7B                     88. Delay1s_loop:
7B 08                  89. 	DECA
7C 25 FD               90. 	BNE	Delay1s_loop
7E CC FF               91. 	LEAX	-1,X
80 9C 00               92. 	CMPX	#0
82 25 F5               93. 	BNE	Delay1s_loop2
84 17                  94. 	PULC
85 15                  95. 	PULX
86 14                  96. 	PULA
87 43                  97. 	RTS
                       98. 
                       99. ; Data - Variabler
88                    100. Count:
88 00                 101. 	RMB	1
                      102. 
                      103. ; Data - Konstanter
89                    104. MorseCode:
89 02 40              105. 	FCB	2,%01000000 ;'A': 0
8B 04 80              106. 	FCB	4,%10000000 ;'B'
8D 04 A0              107. 	FCB	4,%10100000 ;'C'
8F 03 80              108. 	FCB	3,%10000000 ;'D'
91 01 00              109. 	FCB	1,%00000000 ;'E'
93 04 20              110. 	FCB	4,%00100000 ;'F'
95 03 C0              111. 	FCB	3,%11000000 ;'G'
97 04 00              112. 	FCB	4,%00000000 ;'H'
99 02 00              113. 	FCB	2,%00000000 ;'I'
9B 04 70              114. 	FCB	4,%01110000 ;'J'
9D 03 A0              115. 	FCB	3,%10100000 ;'K'
9F 04 40              116. 	FCB	4,%01000000 ;'L'
A1 02 C0              117. 	FCB	2,%11000000 ;'M'
A3 02 80              118. 	FCB	2,%10000000 ;'N'
A5 03 E0              119. 	FCB	3,%11100000 ;'O'
A7 04 60              120. 	FCB	4,%01100000 ;'P'
A9 04 D0              121. 	FCB	4,%11010000 ;'Q'
AB 03 40              122. 	FCB	3,%01000000 ;'R'
AD 03 00              123. 	FCB	3,%00000000 ;'S'
AF 01 80              124. 	FCB	1,%10000000 ;'T'
B1 03 20              125. 	FCB	3,%00100000 ;'U'
B3 04 10              126. 	FCB	4,%00010000 ;'V'
B5 03 60              127. 	FCB	3,%01100000 ;'W'
B7 04 90              128. 	FCB	4,%10010000 ;'X'
B9 04 B0              129. 	FCB	4,%10110000 ;'Y'
BB 04 C0              130. 	FCB	4,%11000000 ;'Z': 25
BD                    131. 	
BD                    132. 	
BD                    133. 	
BD                    134. 	
BD                    135. 	
BD                    136. 	
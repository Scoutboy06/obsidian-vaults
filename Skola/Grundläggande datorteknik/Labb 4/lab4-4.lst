QAflisp - FLISP Absolute crossassembler, Version 1.3
(c) GMV 1989-2023


File: lab4-4.lst
FC                      1. Inport	EQU	$FC
---- File: "lab4-4.sflisp"
FB                      2. Utport	EQU	$FB
05                      3. DelayC1	EQU	$5		;Dessa konstanter styr hur lång fördröjning Delay1s orsakar.
02                      4. DelayC2	EQU	$2		;Ändra dem eventuellt i labbet så att fördröjnigen blir rimligt lång.
                        5. 
FF                      6. 	ORG	$FF
FF 20                   7. 	FCB	$20
                        8. 
20                      9. 	ORG	$20
                       10. 
20                     11. Main:
20 35 FB               12. 	CLR Utport
22                     13. Main_1:
22 34 32               14. 	JSR ReadAscii
24 94 41               15. 	SUBA #$41		; Räkna ut ordningstalet för bokstaven som lästes in. (Ordningstalet för 'A' = 0)
26                     16. 	; Undersök att A är på ett giltigt intervall. Om inte, skapa en loop där
26                     17. 	; lampan tänds (Något är ju fel, så programmet skall fastna här)
26 0B                  18. 	LSLA ; A <- 2A
27 10                  19. 	PSHA
28 90 74               20. 	LDX #MorseCode	; X <- Startadress för tabell med Morsekoder
2A F4                  21. 	LDA A,X  		; A <- M(X+A)
2B E1 73               22. 	STA Count		; Count <- A
2D 14                  23. 	PULA
2E 07                  24. 	INCA			; A <- A+1
2F E4                  25. 	STA A,X  		; A <- M(X+A)
30                     26. 	; Repetera så länge som Count != 0
30                     27. 		; Anropa blinkrutinen
30                     28. 		; A <- A << 1
30                     29. 		; Count <- Count - 1
30                     30. 	; Börja om från inläsningen
30 33 22               31. 	JMP	Main_1
                       32. 
                       33. 
32                     34. ReadAscii:
32 13                  35. 	PSHC
33                     36. ReadAscii_1:
33 F1 FC               37. 	LDA Inport		; A <- Inport
35 98 01               38. 	BITA #%00000001	; CC(Z) = ! A bit0
37 25 FA               39. 	BNE ReadAscii_1	; CC(Z) = 1 ?
39                     40. ReadAscii_2:
39 98 01               41. 	BITA #%00000001	; CC(Z) <- A bit0
3B 24 FC               42. 	BEQ ReadAscii_2 ; CC(Z) = 0 ?
3D 0C                  43. 	LSRA			; A <- A >> 1
3E 17                  44. 	PULC
3F 43                  45. 	RTS				; Retur(A)
                       46. 
                       47. 
40                     48. 	
40                     49. BlinkLight:
40 10                  50. 	PSHA
41 35 FB               51. 	CLR Utport			; A <- 0
43 3A FB               52. 	COM Utport			; A <- $FF
45 98 80               53. 	BITA #%10000000 	; Om bit7 i A = 1
47 22 06               54. 	BMI	BlinkLight_s4	; JA
49 21 00               55. 	BRA BlinkLight_s1	; NEJ
4B                     56. BlinkLight_s1:
4B 34 5F               57. 	JSR Delay1s
4D 33 59               58. 	JMP BlinkLight_end
4F                     59. BlinkLight_s4:
4F 34 5F               60. 	JSR Delay1s
51 34 5F               61. 	JSR Delay1s
53 34 5F               62. 	JSR Delay1s
55 34 5F               63. 	JSR Delay1s
57 33 59               64. 	JMP BlinkLight_end
59                     65. BlinkLight_end:
59 35 FB               66. 	CLR Utport
5B 34 5F               67. 	JSR Delay1s
5D 14                  68. 	PULA
5E 43                  69. 	RTS
5F                     70. 	
5F                     71. 	
                       72. ; Orsakar en fördröjning på ungefär 1s i simulatorn (vid snabb exekveringshastighet)
                       73. ; Ändrar inga register
5F                     74. Delay1s:
5F 10                  75. 	PSHA
60 11                  76. 	PSHX
61 13                  77. 	PSHC
62 90 02               78. 	LDX	#DelayC2
64                     79. Delay1s_loop2:
64 F0 05               80. 	LDA	#DelayC1
66                     81. Delay1s_loop:
66 08                  82. 	DECA
67 25 FD               83. 	BNE	Delay1s_loop
69 CC FF               84. 	LEAX	-1,X
6B 9C 00               85. 	CMPX	#0
6D 25 F5               86. 	BNE	Delay1s_loop2
6F 17                  87. 	PULC
70 15                  88. 	PULX
71 14                  89. 	PULA
72 43                  90. 	RTS
                       91. 
                       92. ; Data - Variabler
73                     93. Count:
73 00                  94. 	RMB	1
                       95. 
                       96. ; Data - Konstanter
74                     97. MorseCode:
74 02 40               98. 	FCB	2,%01000000 ;'A'
76 04 80               99. 	FCB	4,%10000000 ;'B'
78 04 A0              100. 	FCB	4,%10100000 ;'C'
7A 03 80              101. 	FCB	3,%10000000 ;'D'
7C 01 00              102. 	FCB	1,%00000000 ;'E'
7E 04 20              103. 	FCB	4,%00100000 ;'F'
80 03 C0              104. 	FCB	3,%11000000 ;'G'
82 04 00              105. 	FCB	4,%00000000 ;'H'
84 02 00              106. 	FCB	2,%00000000 ;'I'
86 04 70              107. 	FCB	4,%01110000 ;'J'
88 03 A0              108. 	FCB	3,%10100000 ;'K'
8A 04 40              109. 	FCB	4,%01000000 ;'L'
8C 02 C0              110. 	FCB	2,%11000000 ;'M'
8E 02 80              111. 	FCB	2,%10000000 ;'N'
90 03 E0              112. 	FCB	3,%11100000 ;'O'
92 04 60              113. 	FCB	4,%01100000 ;'P'
94 04 D0              114. 	FCB	4,%11010000 ;'Q'
96 03 40              115. 	FCB	3,%01000000 ;'R'
98 03 00              116. 	FCB	3,%00000000 ;'S'
9A 01 80              117. 	FCB	1,%10000000 ;'T'
9C 03 20              118. 	FCB	3,%00100000 ;'U'
9E 04 10              119. 	FCB	4,%00010000 ;'V'
A0 03 60              120. 	FCB	3,%01100000 ;'W'
A2 04 90              121. 	FCB	4,%10010000 ;'X'
A4 04 B0              122. 	FCB	4,%10110000 ;'Y'
A6 04 C0              123. 	FCB	4,%11000000 ;'Z'
A8                    124. 	
A8                    125. 	
A8                    126. 	
A8                    127. 	
A8                    128. 	
A8                    129. 	